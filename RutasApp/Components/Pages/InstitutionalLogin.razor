@page "/login"
@inject NavigationManager Navigation
@inject Microsoft.Extensions.Logging.ILogger<InstitutionalLogin> Logger
@using Microsoft.Extensions.Localization
@using RutasApp.Resources.Languages
@using RutasApp.Services
@inject IStringLocalizer<AppResources> L
@inject LocalizationService Localization

<!-- 
    Componente Contenedor: InstitutionalLogin
    Responsabilidad: Lógica de negocio, inyección de servicios, gestión de estado.
    Patrón: Smart Component
-->

<div class="fixed top-4 right-4 z-50 flex flex-wrap justify-end gap-2 max-w-[200px]">
    <button @onclick='() => ChangeLanguage("es")' class="px-3 py-1 bg-white/10 backdrop-blur-md border border-white/20 rounded-full text-xs font-bold text-white hover:bg-white/20 transition-all shadow-xl">ES</button>
    <button @onclick='() => ChangeLanguage("en")' class="px-3 py-1 bg-white/10 backdrop-blur-md border border-white/20 rounded-full text-xs font-bold text-white hover:bg-white/20 transition-all shadow-xl">EN</button>
    <button @onclick='() => ChangeLanguage("fr")' class="px-3 py-1 bg-white/10 backdrop-blur-md border border-white/20 rounded-full text-xs font-bold text-white hover:bg-white/20 transition-all shadow-xl">FR</button>
    <button @onclick='() => ChangeLanguage("ca")' class="px-3 py-1 bg-white/10 backdrop-blur-md border border-white/20 rounded-full text-xs font-bold text-white hover:bg-white/20 transition-all shadow-xl">CA</button>
    <button @onclick='() => ChangeLanguage("eu")' class="px-3 py-1 bg-white/10 backdrop-blur-md border border-white/20 rounded-full text-xs font-bold text-white hover:bg-white/20 transition-all shadow-xl">EU</button>
    <button @onclick='() => ChangeLanguage("gl")' class="px-3 py-1 bg-white/10 backdrop-blur-md border border-white/20 rounded-full text-xs font-bold text-white hover:bg-white/20 transition-all shadow-xl">GL</button>
</div>

<InstitutionalLoginUI 
    UserCode="@_userCode" 
    Title="@L["InstitutionalAccess"]"
    Subtitle="@L["LoginSubtitle"]"
    LabelCode="@L["InstitutionalUserCode"]"
    ButtonText="@L["AccessApp"]"
    HelpText="@L["HelpQuestion"]"
    OnUserCodeChanged="@(code => _userCode = code)" 
    OnSubmit="HandleSubmit" 
    OnHelpRequested="HandleHelp" />

@code {
    private string? _userCode;

    private void ChangeLanguage(string culture)
    {
        Localization.SetCulture(culture);
        StateHasChanged();
    }

    private async Task HandleSubmit()
    {
        if (string.IsNullOrWhiteSpace(_userCode))
        {
            Logger.LogWarning("Intento de acceso con código vacío.");
            return;
        }

        // Simulación de validación/autenticación
        Logger.LogInformation("Validando código institucional: {Code}", _userCode);
        
        // Simular éxito y navegación
        await Task.Delay(500); 
        Navigation.NavigateTo("/");
    }

    private void HandleHelp()
    {
        Logger.LogInformation("La usuaria solicitó ayuda para encontrar su código.");
        // Mostrar modal o navegar a una página de ayuda
    }
}
